-- membuat fungsi inputPelanggan()
DELIMITER $$
CREATE FUNCTION inputPelanggan(kode VARCHAR(11), nama_pelanggan VARCHAR(255), jk VARCHAR(1), tmp_lahir VARCHAR(255), tgl_lahir DATE, email VARCHAR(255), kartu_id INT(11))
RETURNS INT(11)
DETERMINISTIC
BEGIN
DECLARE id_pelanggan INT(11);

-- memasukkan data pelanggan baru ke dalam tabel pelanggan
INSERT INTO pelanggan (kode, nama_pelanggan, jk, tmp_lahir, tgl_lahir, email, kartu_id) VALUES (kode, nama_pelanggan, jk, tmp_lahir, tgl_lahir, email, kartu_id);

-- menyimpan id pelanggan yang baru saja dibuat
SET id_pelanggan = LAST_INSERT_ID();

RETURN id_pelanggan;
END $$
DELIMITER ;
SELECT inputPelanggan('C012', 'Amara', 'P', 'Jakarta', '1996-05-12', 'amara@gmail.com', 2);

-- Buat fungsi showPelanggan(), setelah itu panggil fungsinya
DELIMITER 
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
ℎ
�
�
�
�
�
�
�
�
�
�
�
(
)
�
�
�
�
�
�
�
�
�
�
�
∗
�
�
�
�
�
�
�
�
�
�
�
�
�
;
�
�
�
CREATEPROCEDUREshowPelanggan()BEGINSELECT∗FROMpelanggan;END
DELIMITER ;

CALL showPelanggan();

-- Buat fungsi inputProduk(), setelah itu panggil fungsinya
DELIMITER 
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
(
�
�
�
�
�
�
�
�
�
�
�
�
�
(
10
)
,
�
�
�
�
�
�
�
�
�
�
�
�
�
(
255
)
,
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
(
11
)
,
�
�
ℎ
�
�
�
�
�
�
�
�
�
�
�
�
�
�
,
�
�
ℎ
�
�
�
�
�
�
�
�
�
�
�
�
�
�
,
�
�
�
�
�
�
�
�
�
(
11
)
,
�
�
�
�
�
�
�
�
�
�
�
�
(
11
)
)
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
(
�
�
�
�
,
�
�
�
�
,
�
�
�
�
�
�
�
�
�
�
�
�
�
,
ℎ
�
�
�
�
�
�
�
�
,
ℎ
�
�
�
�
�
�
�
�
,
�
�
�
�
,
�
�
�
�
�
�
�
)
�
�
�
�
�
�
(
�
�
�
�
,
�
�
�
�
,
�
�
�
�
�
�
�
�
�
�
�
�
�
,
ℎ
�
�
�
�
�
�
�
�
,
ℎ
�
�
�
�
�
�
�
�
,
�
�
�
�
,
�
�
�
�
�
�
�
)
;
�
�
�
CREATEPROCEDUREinputProduk(INkodeVARCHAR(10),INnamaVARCHAR(255),INjenis 
p
​
 roduk 
i
​
 dINT(11),INharga 
j
​
 ualDOUBLE,INharga 
b
​
 eliDOUBLE,INstokINT(11),INmin 
s
​
 tokINT(11))BEGININSERTINTOproduk(kode,nama,jenis 
p
​
 roduk 
i
​
 d,harga 
j
​
 ual,harga 
b
​
 eli,stok,min 
s
​
 tok)VALUES(kode,nama,jenis 
p
​
 roduk 
i
​
 d,harga 
j
​
 ual,harga 
b
​
 eli,stok,min 
s
​
 tok);END
DELIMITER ;
CALL inputProduk('L002', 'Laptop ASUS', 5, 15000000, 10000000, 50, 10);

-- Buat fungsi showProduk(), setelah itu panggil fungsinya
DELIMITER 
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
ℎ
�
�
�
�
�
�
�
�
(
)
�
�
�
�
�
�
�
�
�
�
�
∗
�
�
�
�
�
�
�
�
�
�
;
�
�
�
CREATEPROCEDUREshowProduk()BEGINSELECT∗FROMproduk;END
DELIMITER ;

CALL showProduk();

-- Buat fungsi totalPesanan(), setelah itu panggil fungsinya
DELIMITER 
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
(
)
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
.
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
,
�
�
�
�
�
�
�
�
�
.
�
�
�
�
�
�
�
�
�
�
�
�
�
,
�
�
�
(
�
�
�
�
�
�
�
�
�
�
�
�
.
�
�
�
)
�
�
�
�
�
�
�
�
�
�
�
�
�
,
�
�
�
(
�
�
�
�
�
�
�
�
�
�
�
�
.
�
�
�
∗
�
�
�
�
�
�
�
�
�
�
�
�
.
ℎ
�
�
�
�
)
�
�
�
�
�
�
�
ℎ
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
.
�
�
�
�
�
�
�
�
�
=
�
�
�
�
�
�
�
.
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
.
�
�
�
�
�
�
�
�
�
�
�
=
�
�
�
�
�
�
�
�
�
.
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
�
.
�
�
�
�
,
�
�
�
�
�
�
�
�
�
.
�
�
�
�
�
�
�
�
�
�
�
�
�
;
�
�
�
CREATEPROCEDUREtotalPesanan()BEGINSELECTpelanggan.kodeASkode 
p
​
 elanggan,pelanggan.nama 
p
​
 elanggan,SUM(pesanan 
i
​
 tems.qty)AStotal 
p
​
 roduk,SUM(pesanan 
i
​
 tems.qty∗pesanan 
i
​
 tems.harga)AStotal 
h
​
 argaFROMpesanan 
i
​
 temsJOINpesananONpesanan 
i
​
 tems.pesanan 
i
​
 d=pesanan.idJOINpelangganONpesanan.pelanggan 
i
​
 d=pelanggan.idGROUPBYpelanggan.kode,pelanggan.nama 
p
​
 elanggan;END
DELIMITER ;
CALL totalPesanan();

-- tampilkan seluruh pesanan dari semua pelanggan
DELIMITER $$
CREATE PROCEDURE showAllPesanan()
BEGIN
SELECT pesanan.id AS pesanan_id, pesanan.tanggal, pelanggan.kode AS pelanggan_kode, pelanggan.nama_pelanggan, produk.kode AS produk_kode, produk.nama AS nama_produk, pesanan_items.qty, produk.harga_jual, SUM(pesanan_items.qty * pesanan_items.harga) AS total_harga
FROM pesanan
JOIN pelanggan ON pesanan.pelanggan_id = pelanggan.id